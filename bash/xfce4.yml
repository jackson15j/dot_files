---
- name: Running the xfce4 window manager ansible playbook...
  hosts: localhost
  tasks:
    - name: Get repo base path
      command: git rev-parse --show-toplevel
      register: repo_base_path

    - set_fact:
        base_path: '{{repo_base_path.stdout}}/bash/'

    - name: Symlink xfce4 config directories to ~/.config/
      file:
        src: '{{base_path}}{{item}}'
        dest: '~/.config/{{item}}'
        state: link
        force: yes
      with_items:
        - xfce4
        - redshift

    - name: Install xfce4 packages and dependencies
      # https://wiki.archlinux.org/index.php/Xfce
      become: true
      become_method: sudo
      pacman:
        name: "{{ item }}"
        state: latest
      with_items:
        - xfce4
        - xfce4-goodies
        - network-manager-applet  # Panel applet. TODO: find an xfce variant.
        - blueman  # https://github.com/blueman-project/blueman, BT management.
        - redshift # https://wiki.archlinux.org/index.php/Redshift
        - arandr  # Easy tool to output xrandr displays.

    - name: Enable RedShift night temperature service
      systemd:
        name: redshift-gtk.service
        enabled: True
        state: started
        user: yes

    - name: Symlink .screenlayout directory to ~/.screenlayout
      # xfce is rubbish with hotplugging multiple displays. So lets use arandr
      # to quickly generate the xrandr line to fix this up with a script.
      # TODO: display detection to get our scripts called on hotplug.
      file:
        src: '{{base_path}}.screenlayout'
        dest: ~/.screenlayout
        state: link
        force: yes
